# 🎮 보상 화면 테스트 가이드

## ✅ 구현 완료 사항

### 1. **보상 화면 UI** (`lib/screens/reward_screen.dart`)
완전히 새로운 레이아웃으로 재구현:

#### 📐 레이아웃 구조 (3단 구조)
```
┌─────────────────────────────────────┐
│ 1️⃣ 캐릭터 정보 박스 (고정 높이)     │
│  [초상화] [생명력/정신력] [스탯]     │
├─────────────────────────────────────┤
│ 2️⃣ 보상 아이템 영역 (flex: 2)       │
│   🏆 승리 보상                       │
│  [색깔 블록] [색깔 블록] [색깔 블록] │
├─────────────────────────────────────┤
│ 3️⃣ 인벤토리 그리드 (flex: 3)        │
│   🎒 인벤토리 (9×6 그리드)           │
│   [아이템들이 배치된 모습]           │
├─────────────────────────────────────┤
│        [계속하기 버튼]               │
└─────────────────────────────────────┘
```

#### 🎨 주요 특징
- **캐릭터 정보**: 초상화 + 생명력/정신력 하트 + 4개 스탯 (힘, 민첩, 행운, 매력)
- **보상 영역**: 큰 색깔 블록 3개 (90×90px) - 반짝이 효과 포함
- **인벤토리**: 실시간 인벤토리 그리드 (`CombatInventoryGrid` 재사용)
- **Mock 데이터**: 테스트용 하드코딩된 아이템 3개
  - 강철 검 (rare, 빨간색)
  - 나무 방패 (common, 갈색)
  - 체력 물약 (epic, 밝은 빨강)

---

### 2. **전투 화면 테스트 버튼 수정**
`lib/screens/combat_screen.dart`:
- ❌ **제거**: "승리" 버튼
- ✅ **추가**: "보상 테스트" 버튼 (금색, 검은 글씨)
- 동작: `EnterReward` 이벤트 발송 → 보상 화면으로 전환

---

### 3. **Reducer 수정**
`lib/core/state/reducer.dart`:
- `EnterReward` 이벤트 처리 시 **phase를 `inGame_reward`로 전환**
- 전투 상태 클리어 (`combat: null`)
- 회복 보상 처리 로직 유지

---

## 🧪 테스트 방법

### 1단계: 게임 시작
```bash
flutter run
```

### 2단계: 전투 진입
1. 게임 시작 버튼 클릭
2. 대화 진행 (또는 강제 Next)
3. 전투 인카운터 진입

### 3단계: 보상 화면 테스트
1. 전투 화면 하단의 **"보상 테스트"** 버튼 클릭 (금색 버튼)
2. 보상 화면으로 전환됨

### 4단계: 보상 화면 확인
- ✅ 최상단에 캐릭터 정보 표시되는지 확인
  - 초상화 (파란 배경에 사람 아이콘)
  - 생명력 하트 (빨간색)
  - 정신력 하트 (파란색)
  - 스탯 4개 (힘, 민첩, 행운, 매력)
  
- ✅ 중간에 보상 아이템 3개 표시되는지 확인
  - 색깔 블록 형태
  - 반짝이 효과 (왼쪽 상단 흰색 사각형)
  - 아이템 이름과 등급 표시
  
- ✅ 하단에 인벤토리 그리드 표시되는지 확인
  - 9×6 격자
  - 시작 아이템들 배치됨

### 5단계: 복귀 테스트
1. **"계속하기"** 버튼 클릭
2. 다음 인카운터로 이동 (또는 Next 처리)

---

## 🎨 시각적 검증 포인트

### ✅ 캐릭터 정보 박스
- [ ] 초상화가 정사각형으로 표시됨
- [ ] 생명력 하트가 빨간색으로 표시됨
- [ ] 정신력 하트가 파란색으로 표시됨
- [ ] 4개 스탯이 2×2 그리드로 배치됨

### ✅ 보상 아이템 블록
- [ ] 3개 블록이 가운데 정렬됨
- [ ] 각 블록마다 색깔이 다름 (빨강, 갈색, 밝은 빨강)
- [ ] 그라디언트 효과 (위→아래로 밝음→어두움)
- [ ] 반짝이 효과 (왼쪽 상단 반투명 흰색 사각형)
- [ ] 아이템 이름 중앙 정렬
- [ ] 등급 표시 (RARE, COMMON, EPIC)

### ✅ 인벤토리 그리드
- [ ] 9×6 격자 선이 표시됨
- [ ] 시작 아이템들이 배치됨
- [ ] 아이템 개수 표시 (X / 54)

---

## 🐛 예상 이슈 및 해결

### 이슈 1: 보상 화면이 안 뜸
**원인**: `EnterReward` 이벤트가 제대로 처리 안 됨
**확인**:
```dart
// lib/core/state/reducer.dart
else if (e is EnterReward) {
  // phase를 inGame_reward로 전환하는지 확인
  next = s.copyWith(phase: AppPhase.inGame_reward, combat: null);
}
```

### 이슈 2: 캐릭터 정보가 비어있음
**원인**: `vm.player`가 null
**확인**: 캐릭터 생성이 완료되었는지 확인 (게임 시작 → CharacterCreated 이벤트)

### 이슈 3: 인벤토리가 표시 안 됨
**원인**: `InventorySystem`이 Provider로 등록 안 됨
**확인**: `lib/app/app_wrapper.dart`에서 Provider 확인

### 이슈 4: 버튼 클릭해도 반응 없음
**원인**: GameController가 이벤트를 받지 못함
**확인**: 콘솔에 에러 메시지 확인

---

## 📊 콘솔 로그 예시 (정상 동작)

```
[전투 화면에서 보상 테스트 버튼 클릭]
↓
[Reducer] EnterReward 이벤트 처리
[GameController] Phase transition: inGame_combat → inGame_reward
[RewardScreen] 보상 화면 렌더링 시작
[RewardScreen] 캐릭터 정보: 생명력 4/4, 정신력 4/4
[RewardScreen] Mock 아이템 3개 표시

[계속하기 버튼 클릭]
↓
[RewardScreen] No victory scene, dispatching Next
[GameController] Next 이벤트 처리
```

---

## 🚀 다음 단계 (나중에 구현)

### Phase 1: Mock → 실제 데이터
- [ ] `vm.rewardItems` 필드 추가 (GameVM)
- [ ] CombatModule에서 보상 생성 (RewardSystem 활용)
- [ ] Mock 데이터 제거, 실제 데이터로 교체

### Phase 2: 아이템 지급 로직
- [ ] RewardModule에서 인벤토리에 아이템 추가
- [ ] 공간 부족 처리 (unplacedItems)
- [ ] 인벤토리 변화 애니메이션

### Phase 3: 색깔 블록 → 이미지
- [ ] 아이템 이미지 에셋 추가
- [ ] ItemBlockWidget 분리 (별도 파일)
- [ ] iconPath 자동 전환 로직

---

## 📝 변경된 파일 목록

### 새로 생성
- ✅ `REWARD_SCREEN_TEST_GUIDE.md` (이 파일)

### 완전히 재작성
- ✅ `lib/screens/reward_screen.dart` (600+ 줄)

### 수정
- ✅ `lib/screens/combat_screen.dart` (승리 버튼 → 보상 테스트)
- ✅ `lib/core/state/reducer.dart` (EnterReward phase 전환)

---

## ✅ 테스트 완료 체크리스트

- [ ] 앱이 정상적으로 실행됨
- [ ] 전투 화면에서 "보상 테스트" 버튼이 보임
- [ ] 버튼 클릭 시 보상 화면으로 전환됨
- [ ] 캐릭터 정보가 올바르게 표시됨
- [ ] 보상 아이템 3개가 색깔 블록으로 표시됨
- [ ] 인벤토리 그리드가 표시됨
- [ ] "계속하기" 버튼이 작동함
- [ ] 콘솔에 에러 없음

---

**작성일**: 2025-11-19  
**버전**: 1.0.0  
**상태**: ✅ 구현 완료 (테스트 대기 중)



